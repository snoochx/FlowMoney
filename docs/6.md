# 6. Разработка спецификации ПО

**FlowMoney** — это Android-приложение для управления личными финансами. Приложение использует локальную базу данных **Room** для хранения данных о счетах и операциях.

Приложение реализовано по архитектуре **MVVM**:

- **Model:** Сущности `AccountEntity` и `OperationEntity`, DAO для доступа к базе данных (`AccountDao`, `OperationDao`).
- **View:** Активности и фрагменты Android (`AccountsActivity`, `AccountInfoActivity`, `AddOperationActivity`, `AnalyticsActivity` и др.), отображающие данные пользователю.
- **ViewModel:** `MainViewModel` обеспечивает связь между UI и базой данных.

База данных реализована через **Room**, хранит два типа сущностей: счета и операции.

---

## а) Модуль базы данных

**Класс:** `AppDatabase`  

**Функции:**
- Создание базы данных `flowmoney-db`.
- Предоставление DAO для работы с операциями и счетами.
- Создание основного счета при инициализации базы.

**Ограничения:**
- Используется одна база данных для всех счетов и операций.
- Автоматическое удаление и пересоздание базы при несовпадении версии (`fallbackToDestructiveMigration`).

---

## б) Модуль управления счетами

**Классы:** `AccountDao`, `AccountEntity`  

**Функции DAO:**
- Создание, редактирование, удаление счетов.
- Получение всех счетов (`getAllLive`), основного счета (`getMainAccount`), счета по имени (`getByName`), счета по ID (`getByIdLive`).
- Добавление операций с автоматическим обновлением баланса основного счета (`addOperationAndUpdateMain`).

**Сущности:**
- `AccountEntity`: ID, название счета, баланс, флаг основного счета.

**Ограничения:**
- Основной счет один на базу данных.
- Баланс обновляется только через DAO методы при добавлении операций.

---

## в) Модуль управления операциями

**Классы:** `OperationDao`, `OperationEntity`  

**Функции DAO:**
- Добавление операций (`insert`), удаление по ID (`deleteById`).
- Получение всех операций или фильтрованных по счету, дате, типу (`getAll`, `getOperationsByMonth`, `getOperationsByAccount`).
- Получение суммарного баланса (`getTotalBalanceSync`), доходов/расходов за месяц (`getMonthIncomeLive`, `getMonthExpenseLive`).

**Сущности:**
- `OperationEntity`: ID, сумма, тип (`INCOME`/`EXPENSE`), категория, дата, комментарий, ID счета.

---

## г) Модуль интерфейса пользователя

**Счета:** `AccountsActivity`, `AccountInfoActivity`, `CreateAccountActivity`  
**Операции:** `AddOperationActivity`, `TransferActivity`  
**История операций:** `AnalyticsActivity`  
**Главный экран:** `MainActivity`  

**Особенности UI:**
- Использование `RecyclerView` для отображения списков счетов и операций.
- Динамические диалоги для выбора категорий и счетов (`AlertDialog`).
- Подсветка кнопок и визуализация категорий с иконками и цветами.

**Ограничения:**
- Все взаимодействия с базой данных в отдельных потоках через `Executors` (кроме аналитики, где разрешены `allowMainThreadQueries`).

---

## д) Модуль категорий

**Enum:** `CategoryType`  

**Функции:**
- Хранение списка категорий расходов и доходов с иконками и цветами.
- Преобразование строки в категорию (`fromTitle`).

**Ограничения:**
- Все операции должны принадлежать к одной из категорий.
